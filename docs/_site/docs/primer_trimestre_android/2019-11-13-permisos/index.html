<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Permisos - PMD_19-20</title><link rel="shortcut icon" href="http://localhost:4000/PMD_19-20/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="http://localhost:4000/PMD_19-20/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/PMD_19-20/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/PMD_19-20/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Permisos | PMD_19-20</title><meta name="generator" content="Jekyll v3.8.6" /><meta property="og:title" content="Permisos" /><meta property="og:locale" content="en_US" /><meta name="description" content="Programación multimedia y dispositivos móviles" /><meta property="og:description" content="Programación multimedia y dispositivos móviles" /><link rel="canonical" href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-11-13-permisos/" /><meta property="og:url" content="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-11-13-permisos/" /><meta property="og:site_name" content="PMD_19-20" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-11-13T13:30:00+01:00" /> <script type="application/ld+json"> {"@type":"BlogPosting","headline":"Permisos","dateModified":"2019-11-13T13:30:00+01:00","url":"http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-11-13-permisos/","datePublished":"2019-11-13T13:30:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-11-13-permisos/"},"description":"Programación multimedia y dispositivos móviles","@context":"https://schema.org"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"><title>Link</title><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/PMD_19-20" class="site-title lh-tight"> PMD_19-20 </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item"><a href="http://localhost:4000/PMD_19-20/docs/segundo_trimestre_android/2019-12-01-servicios-hilos/" class="navigation-list-link">Servicios e hilos</a><li class="navigation-list-item"><a href="http://localhost:4000/PMD_19-20/docs/segundo_trimestre_android/2019-12-03-asynctask/" class="navigation-list-link">AsyncTask</a><li class="navigation-list-item"><a href="http://localhost:4000/PMD_19-20/docs/segundo_trimestre_android/2019-12-05-notificaciones/" class="navigation-list-link">Notificaciones</a><li class="navigation-list-item"><a href="http://localhost:4000/PMD_19-20/docs/segundo_trimestre_android/2019-12-12-ficheros/" class="navigation-list-link">Lectura fichero directorio raw</a><li class="navigation-list-item"><a href="http://localhost:4000/PMD_19-20/docs/segundo_trimestre_android/2019-12-17-Alarmas/" class="navigation-list-link">Alarmas</a><li class="navigation-list-item active"><a href="http://localhost:4000/PMD_19-20/" class="navigation-list-link"></a><li class="navigation-list-item active"><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android" class="navigation-list-link">Primer trimestre Android</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-09-25-primera-aplicacion/" class="navigation-list-link">Primera aplicación</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-09-26-metodo-findviewbyid/" class="navigation-list-link">Método FindViewByID</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-10-02-manifest/" class="navigation-list-link">Fichero Manifest</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-10-04-ejemplo_radio_check/" class="navigation-list-link">Ejemplo RadioButton y Checkbox</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-10-09-multi-idioma/" class="navigation-list-link">Compatibilidad entre distintos idiomas</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-10-09-switch-imageview/" class="navigation-list-link">Ejemplo Switch e ImageView</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-10-16-layout/" class="navigation-list-link">Layouts</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-10-17-recorrido-contenedor/" class="navigation-list-link">Recorrido de un TableLayout</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-10-18-ejemplo-fragment/" class="navigation-list-link">Ejemplo sencillo de Fragment</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-10-21-dialogos/" class="navigation-list-link">Diálogos</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-10-28-recyclerView/" class="navigation-list-link">RecyclerView</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-11-06-actionbar/" class="navigation-list-link">Action Bar</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-11-11-intents/" class="navigation-list-link">Intents y filtros de intents</a><li class="navigation-list-item active"><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-11-13-permisos/" class="navigation-list-link active">Permisos</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-11-18-broadcastreceiver/" class="navigation-list-link">Broadcast Receiver y SMS</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-11-19-content-provider/" class="navigation-list-link">Content providers y acceso a los contactos</a><li class="navigation-list-item "><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android/2019-11-24-sqlite/" class="navigation-list-link">SQLite</a></ul><li class="navigation-list-item"><a href="http://localhost:4000/PMD_19-20/docs/segundo_trimestre_android" class="navigation-list-link">Segundo trimestre Android</a><ul class="navigation-list-child-list "></ul></ul></nav></div><footer class="site-footer"><p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p></footer></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header"><div class="search"><div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search PMD_19-20" aria-label="Search PMD_19-20" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg></div><div class="js-search-results search-results-wrap"></div></div><ul class="list-style-none text-small aux-nav"><li class="d-inline-block my-0"><a href="https://github.com/Manuel-Ag/PMD_19-20">GitHub</a></ul></div><div class="page"><nav class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/PMD_19-20/docs/primer_trimestre_android">Primer trimestre Android</a><li class="breadcrumb-nav-list-item"><span>Permisos</span></ol></nav><div id="main-content" class="page-content" role="main"><h1 id="permisos"> <a href="#permisos" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Permisos</h1><p><strong>Antes de nada, visita los siguientes enlaces:</strong></p><ul><li>Guía de permisos: <a href="https://developer.android.com/training/permissions/requesting?hl=es-419">https://developer.android.com/training/permissions/requesting?hl=es-419</a><li>Listado de permisos: <a href="https://developer.android.com/guide/topics/security/permissions.html?hl=es-419">https://developer.android.com/guide/topics/security/permissions.html?hl=es-419</a><li>Buenas prácticas: <a href="https://developer.android.com/training/permissions/usage-notes?hl=es-419">https://developer.android.com/training/permissions/usage-notes?hl=es-419</a></ul><h2 id="cómo-pedir-permisos"> <a href="#cómo-pedir-permisos" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Cómo pedir permisos</h2><p>La forma más fácil es utilizar la que se nos propone en la documentación:</p><p>1. Declararlos en el fichero manifiesto.</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml">    ...
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.READ_CONTACTS"</span><span class="nt">/&gt;</span>
    ...</code></pre></figure><p>2. Pedirlos en tiempo de ejecución (obligatorio a partir del API 23).</p><figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="c1">// Here, thisActivity is the current activity</span>
    <span class="k">if</span> <span class="o">(</span><span class="nc">ContextCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="n">thisActivity</span><span class="o">,</span>
            <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_CONTACTS</span><span class="o">)</span>
            <span class="o">!=</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// Permission is not granted</span>
        <span class="c1">// Should we show an explanation?</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">shouldShowRequestPermissionRationale</span><span class="o">(</span><span class="n">thisActivity</span><span class="o">,</span>
                <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_CONTACTS</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">// Show an explanation to the user *asynchronously* -- don't block</span>
            <span class="c1">// this thread waiting for the user's response! After the user</span>
            <span class="c1">// sees the explanation, try again to request the permission.</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// No explanation needed; request the permission</span>
            <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="n">thisActivity</span><span class="o">,</span>
                    <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_CONTACTS</span><span class="o">},</span>
                    <span class="no">MY_PERMISSIONS_REQUEST_READ_CONTACTS</span><span class="o">);</span>

            <span class="c1">// MY_PERMISSIONS_REQUEST_READ_CONTACTS is an</span>
            <span class="c1">// app-defined int constant. The callback method gets the</span>
            <span class="c1">// result of the request.</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// Permission has already been granted</span>
    <span class="o">}</span></code></pre></figure><h2 id="código-paso-a-paso"> <a href="#código-paso-a-paso" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Código paso a paso</h2><p>En el ejemplo anterior se siguen los siguientes pasos:</p><ul><li>Comprueba si se tienen los permisos</ul><figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="nc">ContextCompat</span><span class="o">.</span><span class="na">checkSelfPermission</span><span class="o">(</span><span class="n">thisActivity</span><span class="o">,</span>
            <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_CONTACTS</span><span class="o">)</span>
            <span class="o">!=</span> <span class="nc">PackageManager</span><span class="o">.</span><span class="na">PERMISSION_GRANTED</span><span class="o">)</span></code></pre></figure><ul><li>En caso de no tenerlos, tenemos otra bifurcación</ul><figure class="highlight"><pre><code class="language-java" data-lang="java">        <span class="k">if</span> <span class="o">(</span><span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">shouldShowRequestPermissionRationale</span><span class="o">(</span><span class="n">thisActivity</span><span class="o">,</span>
                <span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_CONTACTS</span><span class="o">))</span> <span class="o">{</span>
		<span class="c1">// Vacío</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">ActivityCompat</span><span class="o">.</span><span class="na">requestPermissions</span><span class="o">(</span><span class="n">thisActivity</span><span class="o">,</span>
                    <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="nc">Manifest</span><span class="o">.</span><span class="na">permission</span><span class="o">.</span><span class="na">READ_CONTACTS</span><span class="o">},</span>
                    <span class="no">MY_PERMISSIONS_REQUEST_READ_CONTACTS</span><span class="o">);</span></code></pre></figure><p>El método <code class="highlighter-rouge">shouldShowRequestPermissionRationale()</code> sigue el siguiente esquema:</p><p style="text-align: center;"><img src="/PMD_19-20/assets/img_post_permisos/imagen1.png" alt="Android" /></p><p>Por lo que podremos saber si es la primera vez que al usuario se le pide el permiso o no. En caso de insistir al usuario en un permiso, podremos cambiar la funcionalidad al pedir ese permiso, como por ejemplo cambiar la forma de pedirlo, mostrar información adicional en un diálogo, pedir que el usuario lo active desde los ajustes, etc.</p><ul><li>Cuando se acepta o deniega permisos se llamará al siguiente método:</ul><figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestPermissionsResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="nd">@NonNull</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">permissions</span><span class="o">,</span> <span class="nd">@NonNull</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">grantResults</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onRequestPermissionsResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">permissions</span><span class="o">,</span> <span class="n">grantResults</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="no">MY_PERMISSIONS_REQUEST_READ_CONTACTS</span><span class="o">)</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">"Prueba"</span><span class="o">,</span> <span class="s">"Permisos: "</span> <span class="o">+</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">permissions</span><span class="o">)</span> <span class="o">+</span>
                    <span class="s">" Estado:"</span> <span class="o">+</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">grantResults</span><span class="o">));</span>
    <span class="o">}</span></code></pre></figure><p>De esta forma, podremos saber una vez se ha mostrado al usuario el cuadro de conceder permisos o no, las elecciones que ha tomado para cada permiso (llegan como parámetro en los arrays).</p><p>Esto, entre otras cosas, nos facilita saber si el usuario ha seleccionado la opción: <code class="highlighter-rouge">no mostrar otra vez</code> cuando se le pide un permiso. Puedes ver un ejemplo de esta implementación en el siguiente enlace: <a href="https://stackoverflow.com/questions/30719047/android-m-check-runtime-permission-how-to-determine-if-the-user-checked-nev">https://stackoverflow.com/questions/30719047/android-m-check-runtime-permission-how-to-determine-if-the-user-checked-nev</a></p><ul><li><strong>GitHub:</strong> <a href="https://github.com/Manuel-Ag/PMD_19-20/tree/master/Permisos">https://github.com/Manuel-Ag/PMD_19-20/tree/master/Permisos</a></ul><hr><footer role="contentinfo"><p class="text-small text-grey-dk-000 mb-0"></p></footer></div></div></div></div>
